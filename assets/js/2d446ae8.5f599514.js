"use strict";(self.webpackChunktest=self.webpackChunktest||[]).push([[2552],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>g});var a=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=a.createContext({}),l=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},d=function(e){var n=l(e.components);return a.createElement(s.Provider,{value:n},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),u=l(t),c=o,g=u["".concat(s,".").concat(c)]||u[c]||m[c]||i;return t?a.createElement(g,r(r({ref:n},d),{},{components:t})):a.createElement(g,r({ref:n},d))}));function g(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,r=new Array(i);r[0]=c;var p={};for(var s in n)hasOwnProperty.call(n,s)&&(p[s]=n[s]);p.originalType=e,p[u]="string"==typeof e?e:o,r[1]=p;for(var l=2;l<i;l++)r[l]=t[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},5025:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>p,toc:()=>l});var a=t(7462),o=(t(7294),t(3905));const i={sidebar_position:6,title:"Version 11",description:"Upgrade your Next.js Application from Version 10 to Version 11."},r=void 0,p={unversionedId:"pages/building-your-application/upgrading/version-11",id:"pages/building-your-application/upgrading/version-11",title:"Version 11",description:"Upgrade your Next.js Application from Version 10 to Version 11.",source:"@site/docs/03-pages/01-building-your-application/08-upgrading/06-version-11.mdx",sourceDirName:"03-pages/01-building-your-application/08-upgrading",slug:"/pages/building-your-application/upgrading/version-11",permalink:"/nano-nextjs-study/docs/pages/building-your-application/upgrading/version-11",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/03-pages/01-building-your-application/08-upgrading/06-version-11.mdx",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,title:"Version 11",description:"Upgrade your Next.js Application from Version 10 to Version 11."},sidebar:"tutorialSidebar",previous:{title:"Version 12",permalink:"/nano-nextjs-study/docs/pages/building-your-application/upgrading/version-12"},next:{title:"Version 10",permalink:"/nano-nextjs-study/docs/pages/building-your-application/upgrading/version-10"}},s={},l=[{value:"Webpack 5",id:"webpack-5",level:3},{value:"Cleaning the <code>distDir</code> is now a default",id:"cleaning-the-distdir-is-now-a-default",level:3},{value:"<code>PORT</code> is now supported for <code>next dev</code> and <code>next start</code>",id:"port-is-now-supported-for-next-dev-and-next-start",level:3},{value:"<code>next.config.js</code> customization to import images",id:"nextconfigjs-customization-to-import-images",level:3},{value:"Remove <code>super.componentDidCatch()</code> from <code>pages/_app.js</code>",id:"remove-supercomponentdidcatch-from-pages_appjs",level:3},{value:"Remove <code>Container</code> from <code>pages/_app.js</code>",id:"remove-container-from-pages_appjs",level:3},{value:"Remove <code>props.url</code> usage from page components",id:"remove-propsurl-usage-from-page-components",level:3},{value:"Remove <code>unsized</code> property on <code>next/image</code>",id:"remove-unsized-property-on-nextimage",level:3},{value:"Remove <code>modules</code> property on <code>next/dynamic</code>",id:"remove-modules-property-on-nextdynamic",level:3},{value:"Remove <code>Head.rewind</code>",id:"remove-headrewind",level:3},{value:"Moment.js locales excluded by default",id:"momentjs-locales-excluded-by-default",level:3},{value:"Update usage of <code>router.events</code>",id:"update-usage-of-routerevents",level:3},{value:"React 16 to 17",id:"react-16-to-17",level:2}],d={toc:l},u="wrapper";function m(e){let{components:n,...t}=e;return(0,o.kt)(u,(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"To upgrade to version 11, run the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'filename="Terminal"',filename:'"Terminal"'},"npm i next@11 react@17 react-dom@17\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'filename="Terminal"',filename:'"Terminal"'},"yarn add next@11 react@17 react-dom@17\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'filename="Terminal"',filename:'"Terminal"'},"pnpm up next@11 react@17 react-dom@17\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'filename="Terminal"',filename:'"Terminal"'},"bun add next@11 react@17 react-dom@17\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Good to know:")," If you are using TypeScript, ensure you also upgrade ",(0,o.kt)("inlineCode",{parentName:"p"},"@types/react")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"@types/react-dom")," to their corresponding versions.")),(0,o.kt)("h3",{id:"webpack-5"},"Webpack 5"),(0,o.kt)("p",null,"Webpack 5 is now the default for all Next.js applications. If you did not have a custom webpack configuration, your application is already using webpack 5. If you do have a custom webpack configuration, you can refer to the ",(0,o.kt)("a",{parentName:"p",href:"/docs/messages/webpack5"},"Next.js webpack 5 documentation")," for upgrade guidance."),(0,o.kt)("h3",{id:"cleaning-the-distdir-is-now-a-default"},"Cleaning the ",(0,o.kt)("inlineCode",{parentName:"h3"},"distDir")," is now a default"),(0,o.kt)("p",null,"The build output directory (defaults to ",(0,o.kt)("inlineCode",{parentName:"p"},".next"),") is now cleared by default except for the Next.js caches. You can refer to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/vercel/next.js/discussions/6009"},"the cleaning ",(0,o.kt)("inlineCode",{parentName:"a"},"distDir")," RFC")," for more information."),(0,o.kt)("p",null,"If your application was relying on this behavior previously you can disable the new default behavior by adding the ",(0,o.kt)("inlineCode",{parentName:"p"},"cleanDistDir: false")," flag in ",(0,o.kt)("inlineCode",{parentName:"p"},"next.config.js"),"."),(0,o.kt)("h3",{id:"port-is-now-supported-for-next-dev-and-next-start"},(0,o.kt)("inlineCode",{parentName:"h3"},"PORT")," is now supported for ",(0,o.kt)("inlineCode",{parentName:"h3"},"next dev")," and ",(0,o.kt)("inlineCode",{parentName:"h3"},"next start")),(0,o.kt)("p",null,"Next.js 11 supports the ",(0,o.kt)("inlineCode",{parentName:"p"},"PORT")," environment variable to set the port the application runs on. Using ",(0,o.kt)("inlineCode",{parentName:"p"},"-p"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"--port")," is still recommended but if you were prohibited from using ",(0,o.kt)("inlineCode",{parentName:"p"},"-p")," in any way you can now use ",(0,o.kt)("inlineCode",{parentName:"p"},"PORT")," as an alternative:"),(0,o.kt)("p",null,"Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"PORT=4000 next start\n")),(0,o.kt)("h3",{id:"nextconfigjs-customization-to-import-images"},(0,o.kt)("inlineCode",{parentName:"h3"},"next.config.js")," customization to import images"),(0,o.kt)("p",null,"Next.js 11 supports static image imports with ",(0,o.kt)("inlineCode",{parentName:"p"},"next/image"),". This new feature relies on being able to process image imports. If you previously added the ",(0,o.kt)("inlineCode",{parentName:"p"},"next-images")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"next-optimized-images")," packages you can either move to the new built-in support using ",(0,o.kt)("inlineCode",{parentName:"p"},"next/image")," or disable the feature:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="next.config.js"',filename:'"next.config.js"'},"module.exports = {\n    images: {\n        disableStaticImages: true,\n    },\n};\n")),(0,o.kt)("h3",{id:"remove-supercomponentdidcatch-from-pages_appjs"},"Remove ",(0,o.kt)("inlineCode",{parentName:"h3"},"super.componentDidCatch()")," from ",(0,o.kt)("inlineCode",{parentName:"h3"},"pages/_app.js")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"next/app")," component's ",(0,o.kt)("inlineCode",{parentName:"p"},"componentDidCatch")," was deprecated in Next.js 9 as it's no longer needed and has since been a no-op. In Next.js 11, it was removed."),(0,o.kt)("p",null,"If your ",(0,o.kt)("inlineCode",{parentName:"p"},"pages/_app.js")," has a custom ",(0,o.kt)("inlineCode",{parentName:"p"},"componentDidCatch")," method you can remove ",(0,o.kt)("inlineCode",{parentName:"p"},"super.componentDidCatch")," as it is no longer needed."),(0,o.kt)("h3",{id:"remove-container-from-pages_appjs"},"Remove ",(0,o.kt)("inlineCode",{parentName:"h3"},"Container")," from ",(0,o.kt)("inlineCode",{parentName:"h3"},"pages/_app.js")),(0,o.kt)("p",null,"This export was deprecated in Next.js 9 as it's no longer needed and has since been a no-op with a warning during development. In Next.js 11 it was removed."),(0,o.kt)("p",null,"If your ",(0,o.kt)("inlineCode",{parentName:"p"},"pages/_app.js")," imports ",(0,o.kt)("inlineCode",{parentName:"p"},"Container")," from ",(0,o.kt)("inlineCode",{parentName:"p"},"next/app")," you can remove ",(0,o.kt)("inlineCode",{parentName:"p"},"Container")," as it was removed. Learn more in ",(0,o.kt)("a",{parentName:"p",href:"/docs/messages/app-container-deprecated"},"the documentation"),"."),(0,o.kt)("h3",{id:"remove-propsurl-usage-from-page-components"},"Remove ",(0,o.kt)("inlineCode",{parentName:"h3"},"props.url")," usage from page components"),(0,o.kt)("p",null,"This property was deprecated in Next.js 4 and has since shown a warning during development. With the introduction of ",(0,o.kt)("inlineCode",{parentName:"p"},"getStaticProps")," / ",(0,o.kt)("inlineCode",{parentName:"p"},"getServerSideProps")," these methods already disallowed the usage of ",(0,o.kt)("inlineCode",{parentName:"p"},"props.url"),". In Next.js 11, it was removed completely."),(0,o.kt)("p",null,"You can learn more in ",(0,o.kt)("a",{parentName:"p",href:"/docs/messages/url-deprecated"},"the documentation"),"."),(0,o.kt)("h3",{id:"remove-unsized-property-on-nextimage"},"Remove ",(0,o.kt)("inlineCode",{parentName:"h3"},"unsized")," property on ",(0,o.kt)("inlineCode",{parentName:"h3"},"next/image")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"unsized")," property on ",(0,o.kt)("inlineCode",{parentName:"p"},"next/image")," was deprecated in Next.js 10.0.1. You can use ",(0,o.kt)("inlineCode",{parentName:"p"},'layout="fill"')," instead. In Next.js 11 ",(0,o.kt)("inlineCode",{parentName:"p"},"unsized")," was removed."),(0,o.kt)("h3",{id:"remove-modules-property-on-nextdynamic"},"Remove ",(0,o.kt)("inlineCode",{parentName:"h3"},"modules")," property on ",(0,o.kt)("inlineCode",{parentName:"h3"},"next/dynamic")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"modules")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"render")," option for ",(0,o.kt)("inlineCode",{parentName:"p"},"next/dynamic")," were deprecated in Next.js 9.5. This was done in order to make the ",(0,o.kt)("inlineCode",{parentName:"p"},"next/dynamic")," API closer to ",(0,o.kt)("inlineCode",{parentName:"p"},"React.lazy"),". In Next.js 11, the ",(0,o.kt)("inlineCode",{parentName:"p"},"modules")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"render")," options were removed."),(0,o.kt)("p",null,"This option hasn't been mentioned in the documentation since Next.js 8 so it's less likely that your application is using it."),(0,o.kt)("p",null,"If your application does use ",(0,o.kt)("inlineCode",{parentName:"p"},"modules")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"render")," you can refer to ",(0,o.kt)("a",{parentName:"p",href:"/docs/messages/next-dynamic-modules"},"the documentation"),"."),(0,o.kt)("h3",{id:"remove-headrewind"},"Remove ",(0,o.kt)("inlineCode",{parentName:"h3"},"Head.rewind")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Head.rewind")," has been a no-op since Next.js 9.5, in Next.js 11 it was removed. You can safely remove your usage of ",(0,o.kt)("inlineCode",{parentName:"p"},"Head.rewind"),"."),(0,o.kt)("h3",{id:"momentjs-locales-excluded-by-default"},"Moment.js locales excluded by default"),(0,o.kt)("p",null,"Moment.js includes translations for a lot of locales by default. Next.js now automatically excludes these locales by default to optimize bundle size for applications using Moment.js."),(0,o.kt)("p",null,"To load a specific locale use this snippet:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import moment from "moment";\nimport "moment/locale/ja";\n\nmoment.locale("ja");\n')),(0,o.kt)("p",null,"You can opt-out of this new default by adding ",(0,o.kt)("inlineCode",{parentName:"p"},"excludeDefaultMomentLocales: false")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"next.config.js")," if you do not want the new behavior, do note it's highly recommended to not disable this new optimization as it significantly reduces the size of Moment.js."),(0,o.kt)("h3",{id:"update-usage-of-routerevents"},"Update usage of ",(0,o.kt)("inlineCode",{parentName:"h3"},"router.events")),(0,o.kt)("p",null,"In case you're accessing ",(0,o.kt)("inlineCode",{parentName:"p"},"router.events")," during rendering, in Next.js 11 ",(0,o.kt)("inlineCode",{parentName:"p"},"router.events")," is no longer provided during pre-rendering. Ensure you're accessing ",(0,o.kt)("inlineCode",{parentName:"p"},"router.events")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"useEffect"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'useEffect(() => {\n    const handleRouteChange = (url, { shallow }) => {\n        console.log(\n            `App is changing to ${url} ${\n                shallow ? "with" : "without"\n            } shallow routing`,\n        );\n    };\n\n    router.events.on("routeChangeStart", handleRouteChange);\n\n    // If the component is unmounted, unsubscribe\n    // from the event with the `off` method:\n    return () => {\n        router.events.off("routeChangeStart", handleRouteChange);\n    };\n}, [router]);\n')),(0,o.kt)("p",null,"If your application uses ",(0,o.kt)("inlineCode",{parentName:"p"},"router.router.events")," which was an internal property that was not public please make sure to use ",(0,o.kt)("inlineCode",{parentName:"p"},"router.events")," as well."),(0,o.kt)("h2",{id:"react-16-to-17"},"React 16 to 17"),(0,o.kt)("p",null,"React 17 introduced a new ",(0,o.kt)("a",{parentName:"p",href:"https://reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html"},"JSX Transform")," that brings a long-time Next.js feature to the wider React ecosystem: Not having to ",(0,o.kt)("inlineCode",{parentName:"p"},"import React from 'react'")," when using JSX. When using React 17 Next.js will automatically use the new transform. This transform does not make the ",(0,o.kt)("inlineCode",{parentName:"p"},"React")," variable global, which was an unintended side-effect of the previous Next.js implementation. A ",(0,o.kt)("a",{parentName:"p",href:"/docs/pages/building-your-application/upgrading/codemods#add-missing-react-import"},"codemod is available")," to automatically fix cases where you accidentally used ",(0,o.kt)("inlineCode",{parentName:"p"},"React")," without importing it."),(0,o.kt)("p",null,"Most applications already use the latest version of React, with Next.js 11 the minimum React version has been updated to 17.0.2."),(0,o.kt)("p",null,"To upgrade you can run the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"npm install react@latest react-dom@latest\n")),(0,o.kt)("p",null,"Or using ",(0,o.kt)("inlineCode",{parentName:"p"},"yarn"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"yarn add react@latest react-dom@latest\n")))}m.isMDXComponent=!0}}]);