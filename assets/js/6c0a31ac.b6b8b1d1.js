"use strict";(self.webpackChunktest=self.webpackChunktest||[]).push([[4201],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var a=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n,a,s={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,s=e.mdxType,i=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=p(n),d=s,g=c["".concat(l,".").concat(d)]||c[d]||m[d]||i;return n?a.createElement(g,r(r({ref:t},u),{},{components:n})):a.createElement(g,r({ref:t},u))}));function g(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var i=n.length,r=new Array(i);r[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[c]="string"==typeof e?e:s,r[1]=o;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2164:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=n(7462),s=(n(7294),n(3905));const i={sidebar_position:10,title:"Testing",description:"Learn how to set up Next.js with three commonly used testing tools \u2014 Cypress, Playwright, Jest, and React Testing Library."},r=void 0,o={unversionedId:"pages/building-your-application/optimizing/testing",id:"pages/building-your-application/optimizing/testing",title:"Testing",description:"Learn how to set up Next.js with three commonly used testing tools \u2014 Cypress, Playwright, Jest, and React Testing Library.",source:"@site/docs/03-pages/01-building-your-application/05-optimizing/10-testing.mdx",sourceDirName:"03-pages/01-building-your-application/05-optimizing",slug:"/pages/building-your-application/optimizing/testing",permalink:"/docs/pages/building-your-application/optimizing/testing",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/03-pages/01-building-your-application/05-optimizing/10-testing.mdx",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10,title:"Testing",description:"Learn how to set up Next.js with three commonly used testing tools \u2014 Cypress, Playwright, Jest, and React Testing Library."},sidebar:"nextJsSidebar",previous:{title:"Instrumentation",permalink:"/docs/pages/building-your-application/optimizing/instrumentation"},next:{title:"Third Party Libraries",permalink:"/docs/pages/building-your-application/optimizing/third-party-libraries"}},l={},p=[{value:"Cypress",id:"cypress",level:2},{value:"Quickstart",id:"quickstart",level:3},{value:"Manual setup",id:"manual-setup",level:3},{value:"Should I use E2E or Component Tests?",id:"should-i-use-e2e-or-component-tests",level:3},{value:"Creating your first Cypress E2E test",id:"creating-your-first-cypress-e2e-test",level:3},{value:"Creating your first Cypress component test",id:"creating-your-first-cypress-component-test",level:3},{value:"Running your Cypress tests",id:"running-your-cypress-tests",level:3},{value:"E2E Tests",id:"e2e-tests",level:4},{value:"Component Tests",id:"component-tests",level:4},{value:"Getting ready for Continuous Integration (CI)",id:"getting-ready-for-continuous-integration-ci",level:3},{value:"Playwright",id:"playwright",level:2},{value:"Quickstart",id:"quickstart-1",level:3},{value:"Manual setup",id:"manual-setup-1",level:3},{value:"Creating your first Playwright end-to-end test",id:"creating-your-first-playwright-end-to-end-test",level:3},{value:"Running your Playwright tests",id:"running-your-playwright-tests",level:3},{value:"Running Playwright on Continuous Integration (CI)",id:"running-playwright-on-continuous-integration-ci",level:3},{value:"Jest and React Testing Library",id:"jest-and-react-testing-library",level:2},{value:"Quickstart",id:"quickstart-2",level:3},{value:"Setting up Jest (with the Rust Compiler)",id:"setting-up-jest-with-the-rust-compiler",level:3},{value:"Setting up Jest (with Babel)",id:"setting-up-jest-with-babel",level:3},{value:"Creating your tests:",id:"creating-your-tests",level:3},{value:"Community Packages and Examples",id:"community-packages-and-examples",level:2}],u={toc:p},c="wrapper";function m(e){let{components:t,...n}=e;return(0,s.kt)(c,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("details",{open:!0},(0,s.kt)("summary",null,"Examples"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/vercel/next.js/tree/canary/examples/with-cypress"},"Next.js with Cypress")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/vercel/next.js/tree/canary/examples/with-playwright"},"Next.js with Playwright")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/vercel/next.js/tree/canary/examples/with-jest"},"Next.js with Jest and React Testing Library")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/vercel/next.js/tree/canary/examples/with-vitest"},"Next.js with Vitest")))),(0,s.kt)("p",null,"Learn how to set up Next.js with commonly used testing tools: ",(0,s.kt)("a",{parentName:"p",href:"#cypress"},"Cypress"),", ",(0,s.kt)("a",{parentName:"p",href:"#playwright"},"Playwright"),", and ",(0,s.kt)("a",{parentName:"p",href:"#jest-and-react-testing-library"},"Jest with React Testing Library"),"."),(0,s.kt)("h2",{id:"cypress"},"Cypress"),(0,s.kt)("p",null,"Cypress is a test runner used for ",(0,s.kt)("strong",{parentName:"p"},"End-to-End (E2E)")," and ",(0,s.kt)("strong",{parentName:"p"},"Component Testing"),"."),(0,s.kt)("h3",{id:"quickstart"},"Quickstart"),(0,s.kt)("p",null,"You can use ",(0,s.kt)("inlineCode",{parentName:"p"},"create-next-app")," with the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/vercel/next.js/tree/canary/examples/with-cypress"},"with-cypress example")," to quickly get started."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash",metastring:'filename="Terminal"',filename:'"Terminal"'},"npx create-next-app@latest --example with-cypress with-cypress-app\n")),(0,s.kt)("h3",{id:"manual-setup"},"Manual setup"),(0,s.kt)("p",null,"To get started with Cypress, install the ",(0,s.kt)("inlineCode",{parentName:"p"},"cypress")," package:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash",metastring:'filename="Terminal"',filename:'"Terminal"'},"npm install --save-dev cypress\n")),(0,s.kt)("p",null,"Add Cypress to the ",(0,s.kt)("inlineCode",{parentName:"p"},"package.json")," scripts field:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json",metastring:'filename="package.json"',filename:'"package.json"'},'{\n    "scripts": {\n        "dev": "next dev",\n        "build": "next build",\n        "start": "next start",\n        "cypress:open": "cypress open"\n    }\n}\n')),(0,s.kt)("p",null,"Run Cypress for the first time to generate examples that use their recommended folder structure:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash",metastring:'filename="Terminal"',filename:'"Terminal"'},"npm run cypress:open\n")),(0,s.kt)("p",null,"You can look through the generated examples and the ",(0,s.kt)("a",{parentName:"p",href:"https://docs.cypress.io/guides/getting-started/writing-your-first-test"},"Writing Your First Test")," section of the Cypress Documentation to help you get familiar with Cypress."),(0,s.kt)("h3",{id:"should-i-use-e2e-or-component-tests"},"Should I use E2E or Component Tests?"),(0,s.kt)("p",null,"The ",(0,s.kt)("a",{parentName:"p",href:"https://docs.cypress.io/guides/core-concepts/testing-types"},"Cypress docs contain a guide")," on the difference between these two types of tests and when it is appropriate to use each."),(0,s.kt)("h3",{id:"creating-your-first-cypress-e2e-test"},"Creating your first Cypress E2E test"),(0,s.kt)("p",null,"Assuming the following two Next.js pages:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'filename="pages/index.js"',filename:'"pages/index.js"'},'import Link from "next/link";\n\nexport default function Home() {\n    return (\n        <nav>\n            <h1>Homepage</h1>\n            <Link href="/about">About</Link>\n        </nav>\n    );\n}\n')),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'filename="pages/about.js"',filename:'"pages/about.js"'},'export default function About() {\n    return (\n        <div>\n            <h1>About Page</h1>\n            <Link href="/">Homepage</Link>\n        </div>\n    );\n}\n')),(0,s.kt)("p",null,"Add a test to check your navigation is working correctly:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="cypress/e2e/app.cy.js"',filename:'"cypress/e2e/app.cy.js"'},'describe("Navigation", () => {\n    it("should navigate to the about page", () => {\n        // Start from the index page\n        cy.visit("http://localhost:3000/");\n\n        // Find a link with an href attribute containing "about" and click it\n        cy.get(\'a[href*="about"]\').click();\n\n        // The new url should include "/about"\n        cy.url().should("include", "/about");\n\n        // The new page should contain an h1 with "About page"\n        cy.get("h1").contains("About Page");\n    });\n});\n')),(0,s.kt)("p",null,"You can use ",(0,s.kt)("inlineCode",{parentName:"p"},'cy.visit("/")')," instead of ",(0,s.kt)("inlineCode",{parentName:"p"},'cy.visit("http://localhost:3000/")')," if you add ",(0,s.kt)("inlineCode",{parentName:"p"},"baseUrl: 'http://localhost:3000'")," to the ",(0,s.kt)("inlineCode",{parentName:"p"},"cypress.config.js")," configuration file."),(0,s.kt)("h3",{id:"creating-your-first-cypress-component-test"},"Creating your first Cypress component test"),(0,s.kt)("p",null,"Component tests build and mount a specific component without having to bundle your whole application or launch a server. This allows for more performant tests that still provide visual feedback and the same API used for Cypress E2E tests."),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("strong",{parentName:"p"},"Good to know"),": Since component tests do not launch a Next.js server, capabilities like ",(0,s.kt)("inlineCode",{parentName:"p"},"<Image />")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"getServerSideProps")," which rely on a server being available will not function out-of-the-box. See the ",(0,s.kt)("a",{parentName:"p",href:"https://docs.cypress.io/guides/component-testing/react/overview#Nextjs"},"Cypress Next.js docs")," for examples of getting these features working within component tests.")),(0,s.kt)("p",null,"Assuming the same components from the previous section, add a test to validate a component is rendering the expected output:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'filename="pages/about.cy.js"',filename:'"pages/about.cy.js"'},'import AboutPage from "./about.js";\n\ndescribe("<AboutPage />", () => {\n    it("should render and display expected content", () => {\n        // Mount the React component for the About page\n        cy.mount(<AboutPage />);\n\n        // The new page should contain an h1 with "About page"\n        cy.get("h1").contains("About Page");\n\n        // Validate that a link with the expected URL is present\n        // *Following* the link is better suited to an E2E test\n        cy.get(\'a[href="/"]\').should("be.visible");\n    });\n});\n')),(0,s.kt)("h3",{id:"running-your-cypress-tests"},"Running your Cypress tests"),(0,s.kt)("h4",{id:"e2e-tests"},"E2E Tests"),(0,s.kt)("p",null,"Since Cypress E2E tests are testing a real Next.js application they require the Next.js server to be running prior to starting Cypress. We recommend running your tests against your production code to more closely resemble how your application will behave."),(0,s.kt)("p",null,"Run ",(0,s.kt)("inlineCode",{parentName:"p"},"npm run build")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"npm run start"),", then run ",(0,s.kt)("inlineCode",{parentName:"p"},"npm run cypress -- --e2e")," in another terminal window to start Cypress and run your E2E testing suite."),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("strong",{parentName:"p"},"Good to know"),": Alternatively, you can install the ",(0,s.kt)("inlineCode",{parentName:"p"},"start-server-and-test")," package and add it to the ",(0,s.kt)("inlineCode",{parentName:"p"},"package.json")," scripts field: ",(0,s.kt)("inlineCode",{parentName:"p"},'"test": "start-server-and-test start http://localhost:3000 cypress"')," to start the Next.js production server in conjunction with Cypress. Remember to rebuild your application after new changes.")),(0,s.kt)("h4",{id:"component-tests"},"Component Tests"),(0,s.kt)("p",null,"Run ",(0,s.kt)("inlineCode",{parentName:"p"},"npm run cypress -- --component")," to start Cypress and execute your component testing suite."),(0,s.kt)("h3",{id:"getting-ready-for-continuous-integration-ci"},"Getting ready for Continuous Integration (CI)"),(0,s.kt)("p",null,"You will have noticed that running Cypress so far has opened an interactive browser which is not ideal for CI environments. You can also run Cypress headlessly using the ",(0,s.kt)("inlineCode",{parentName:"p"},"cypress run")," command:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json",metastring:'filename="package.json"',filename:'"package.json"'},'{\n    "scripts": {\n        //...\n        "e2e": "start-server-and-test dev http://localhost:3000 \\"cypress open --e2e\\"",\n        "e2e:headless": "start-server-and-test dev http://localhost:3000 \\"cypress run --e2e\\"",\n        "component": "cypress open --component",\n        "component:headless": "cypress run --component"\n    }\n}\n')),(0,s.kt)("p",null,"You can learn more about Cypress and Continuous Integration from these resources:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://docs.cypress.io/guides/continuous-integration/introduction"},"Cypress Continuous Integration Docs")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://on.cypress.io/github-actions"},"Cypress GitHub Actions Guide")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/cypress-io/github-action"},"Official Cypress GitHub Action")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://discord.com/invite/cypress"},"Cypress Discord"))),(0,s.kt)("h2",{id:"playwright"},"Playwright"),(0,s.kt)("p",null,"Playwright is a testing framework that lets you automate Chromium, Firefox, and WebKit with a single API. You can use it to write ",(0,s.kt)("strong",{parentName:"p"},"End-to-End (E2E)")," and ",(0,s.kt)("strong",{parentName:"p"},"Integration")," tests across all platforms."),(0,s.kt)("h3",{id:"quickstart-1"},"Quickstart"),(0,s.kt)("p",null,"The fastest way to get started is to use ",(0,s.kt)("inlineCode",{parentName:"p"},"create-next-app")," with the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/vercel/next.js/tree/canary/examples/with-playwright"},"with-playwright example"),". This will create a Next.js project complete with Playwright all set up."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash",metastring:'filename="Terminal"',filename:'"Terminal"'},"npx create-next-app@latest --example with-playwright with-playwright-app\n")),(0,s.kt)("h3",{id:"manual-setup-1"},"Manual setup"),(0,s.kt)("p",null,"You can also use ",(0,s.kt)("inlineCode",{parentName:"p"},"npm init playwright")," to add Playwright to an existing ",(0,s.kt)("inlineCode",{parentName:"p"},"NPM")," project."),(0,s.kt)("p",null,"To manually get started with Playwright, install the ",(0,s.kt)("inlineCode",{parentName:"p"},"@playwright/test")," package:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash",metastring:'filename="Terminal"',filename:'"Terminal"'},"npm install --save-dev @playwright/test\n")),(0,s.kt)("p",null,"Add Playwright to the ",(0,s.kt)("inlineCode",{parentName:"p"},"package.json")," scripts field:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json",metastring:'filename="package.json"',filename:'"package.json"'},'{\n    "scripts": {\n        "dev": "next dev",\n        "build": "next build",\n        "start": "next start",\n        "test:e2e": "playwright test"\n    }\n}\n')),(0,s.kt)("h3",{id:"creating-your-first-playwright-end-to-end-test"},"Creating your first Playwright end-to-end test"),(0,s.kt)("p",null,"Assuming the following two Next.js pages:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'filename="pages/index.js"',filename:'"pages/index.js"'},'import Link from "next/link";\n\nexport default function Home() {\n    return (\n        <nav>\n            <Link href="/about">About</Link>\n        </nav>\n    );\n}\n')),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'filename="pages/about.js"',filename:'"pages/about.js"'},"export default function About() {\n    return (\n        <div>\n            <h1>About Page</h1>\n        </div>\n    );\n}\n")),(0,s.kt)("p",null,"Add a test to verify that your navigation is working correctly:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="e2e/example.spec.ts" switcher',filename:'"e2e/example.spec.ts"',switcher:!0},'import { test, expect } from "@playwright/test";\n\ntest("should navigate to the about page", async ({ page }) => {\n    // Start from the index page (the baseURL is set via the webServer in the playwright.config.ts)\n    await page.goto("http://localhost:3000/");\n    // Find an element with the text \'About Page\' and click on it\n    await page.click("text=About");\n    // The new URL should be "/about" (baseURL is used there)\n    await expect(page).toHaveURL("http://localhost:3000/about");\n    // The new page should contain an h1 with "About Page"\n    await expect(page.locator("h1")).toContainText("About Page");\n});\n')),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="e2e/example.spec.js" switcher',filename:'"e2e/example.spec.js"',switcher:!0},'import { test, expect } from "@playwright/test";\n\ntest("should navigate to the about page", async ({ page }) => {\n    // Start from the index page (the baseURL is set via the webServer in the playwright.config.ts)\n    await page.goto("http://localhost:3000/");\n    // Find an element with the text \'About Page\' and click on it\n    await page.click("text=About");\n    // The new URL should be "/about" (baseURL is used there)\n    await expect(page).toHaveURL("http://localhost:3000/about");\n    // The new page should contain an h1 with "About Page"\n    await expect(page.locator("h1")).toContainText("About Page");\n});\n')),(0,s.kt)("p",null,"You can use ",(0,s.kt)("inlineCode",{parentName:"p"},'page.goto("/")')," instead of ",(0,s.kt)("inlineCode",{parentName:"p"},'page.goto("http://localhost:3000/")'),", if you add ",(0,s.kt)("a",{parentName:"p",href:"https://playwright.dev/docs/api/class-testoptions#test-options-base-url"},(0,s.kt)("inlineCode",{parentName:"a"},'"baseURL": "http://localhost:3000"'))," to the ",(0,s.kt)("inlineCode",{parentName:"p"},"playwright.config.ts")," configuration file."),(0,s.kt)("h3",{id:"running-your-playwright-tests"},"Running your Playwright tests"),(0,s.kt)("p",null,"Since Playwright is testing a real Next.js application, it requires the Next.js server to be running prior to starting Playwright. It is recommended to run your tests against your production code to more closely resemble how your application will behave."),(0,s.kt)("p",null,"Run ",(0,s.kt)("inlineCode",{parentName:"p"},"npm run build")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"npm run start"),", then run ",(0,s.kt)("inlineCode",{parentName:"p"},"npm run test:e2e")," in another terminal window to run the Playwright tests."),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("strong",{parentName:"p"},"Good to know"),": Alternatively, you can use the ",(0,s.kt)("a",{parentName:"p",href:"https://playwright.dev/docs/test-webserver/"},(0,s.kt)("inlineCode",{parentName:"a"},"webServer"))," feature to let Playwright start the development server and wait until it's fully available.")),(0,s.kt)("h3",{id:"running-playwright-on-continuous-integration-ci"},"Running Playwright on Continuous Integration (CI)"),(0,s.kt)("p",null,"Playwright will by default run your tests in the ",(0,s.kt)("a",{parentName:"p",href:"https://playwright.dev/docs/ci#running-headed"},"headless mode"),". To install all the Playwright dependencies, run ",(0,s.kt)("inlineCode",{parentName:"p"},"npx playwright install-deps"),"."),(0,s.kt)("p",null,"You can learn more about Playwright and Continuous Integration from these resources:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://playwright.dev/docs/intro"},"Getting started with Playwright")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://playwright.dev/docs/test-webserver/"},"Use a development server")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://playwright.dev/docs/ci"},"Playwright on your CI provider")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://discord.com/invite/playwright-807756831384403968"},"Playwright Discord"))),(0,s.kt)("h2",{id:"jest-and-react-testing-library"},"Jest and React Testing Library"),(0,s.kt)("p",null,"Jest and React Testing Library are frequently used together for ",(0,s.kt)("strong",{parentName:"p"},"Unit Testing"),". There are three ways you can start using Jest within your Next.js application:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Using one of our ",(0,s.kt)("a",{parentName:"li",href:"#quickstart-2"},"quickstart examples")),(0,s.kt)("li",{parentName:"ol"},"With the ",(0,s.kt)("a",{parentName:"li",href:"#setting-up-jest-with-the-rust-compiler"},"Next.js Rust Compiler")),(0,s.kt)("li",{parentName:"ol"},"With ",(0,s.kt)("a",{parentName:"li",href:"#setting-up-jest-with-babel"},"Babel"))),(0,s.kt)("p",null,"The following sections will go through how you can set up Jest with each of these options:"),(0,s.kt)("h3",{id:"quickstart-2"},"Quickstart"),(0,s.kt)("p",null,"You can use ",(0,s.kt)("inlineCode",{parentName:"p"},"create-next-app")," with the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/vercel/next.js/tree/canary/examples/with-jest"},"with-jest")," example to quickly get started with Jest and React Testing Library:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash",metastring:'filename="Terminal"',filename:'"Terminal"'},"npx create-next-app@latest --example with-jest with-jest-app\n")),(0,s.kt)("h3",{id:"setting-up-jest-with-the-rust-compiler"},"Setting up Jest (with the Rust Compiler)"),(0,s.kt)("p",null,"Since the release of ",(0,s.kt)("a",{parentName:"p",href:"https://nextjs.org/blog/next-12"},"Next.js 12"),", Next.js now has built-in configuration for Jest."),(0,s.kt)("p",null,"To set up Jest, install ",(0,s.kt)("inlineCode",{parentName:"p"},"jest"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"jest-environment-jsdom"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"@testing-library/react"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"@testing-library/jest-dom"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash",metastring:'filename="Terminal"',filename:'"Terminal"'},"npm install --save-dev jest jest-environment-jsdom @testing-library/react @testing-library/jest-dom\n")),(0,s.kt)("p",null,"Create a ",(0,s.kt)("inlineCode",{parentName:"p"},"jest.config.mjs")," file in your project's root directory and add the following:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="jest.config.mjs"',filename:'"jest.config.mjs"'},'import nextJest from "next/jest.js";\n\nconst createJestConfig = nextJest({\n    // Provide the path to your Next.js app to load next.config.js and .env files in your test environment\n    dir: "./",\n});\n\n// Add any custom config to be passed to Jest\n/** @type {import(\'jest\').Config} */\nconst config = {\n    // Add more setup options before each test is run\n    // setupFilesAfterEnv: [\'<rootDir>/jest.setup.js\'],\n\n    testEnvironment: "jest-environment-jsdom",\n};\n\n// createJestConfig is exported this way to ensure that next/jest can load the Next.js config which is async\nexport default createJestConfig(config);\n')),(0,s.kt)("p",null,"Under the hood, ",(0,s.kt)("inlineCode",{parentName:"p"},"next/jest")," is automatically configuring Jest for you, including:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Setting up ",(0,s.kt)("inlineCode",{parentName:"li"},"transform")," using ",(0,s.kt)("a",{parentName:"li",href:"/docs/architecture/nextjs-compiler"},"SWC")),(0,s.kt)("li",{parentName:"ul"},"Auto mocking stylesheets (",(0,s.kt)("inlineCode",{parentName:"li"},".css"),", ",(0,s.kt)("inlineCode",{parentName:"li"},".module.css"),", and their scss variants), image imports and ",(0,s.kt)("a",{parentName:"li",href:"/docs/pages/building-your-application/optimizing/fonts"},(0,s.kt)("inlineCode",{parentName:"a"},"next/font"))),(0,s.kt)("li",{parentName:"ul"},"Loading ",(0,s.kt)("inlineCode",{parentName:"li"},".env")," (and all variants) into ",(0,s.kt)("inlineCode",{parentName:"li"},"process.env")),(0,s.kt)("li",{parentName:"ul"},"Ignoring ",(0,s.kt)("inlineCode",{parentName:"li"},"node_modules")," from test resolving and transforms"),(0,s.kt)("li",{parentName:"ul"},"Ignoring ",(0,s.kt)("inlineCode",{parentName:"li"},".next")," from test resolving"),(0,s.kt)("li",{parentName:"ul"},"Loading ",(0,s.kt)("inlineCode",{parentName:"li"},"next.config.js")," for flags that enable SWC transforms")),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("strong",{parentName:"p"},"Good to know"),": To test environment variables directly, load them manually in a separate setup script or in your ",(0,s.kt)("inlineCode",{parentName:"p"},"jest.config.js")," file. For more information, please see ",(0,s.kt)("a",{parentName:"p",href:"/docs/pages/building-your-application/configuring/environment-variables#test-environment-variables"},"Test Environment Variables"),".")),(0,s.kt)("h3",{id:"setting-up-jest-with-babel"},"Setting up Jest (with Babel)"),(0,s.kt)("p",null,"If you opt out of the ",(0,s.kt)("a",{parentName:"p",href:"/docs/architecture/nextjs-compiler"},"Rust Compiler"),", you will need to manually configure Jest and install ",(0,s.kt)("inlineCode",{parentName:"p"},"babel-jest")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"identity-obj-proxy")," in addition to the packages above."),(0,s.kt)("p",null,"Here are the recommended options to configure Jest for Next.js:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="jest.config.js"',filename:'"jest.config.js"'},'module.exports = {\n    collectCoverage: true,\n    // on node 14.x coverage provider v8 offers good speed and more or less good report\n    coverageProvider: "v8",\n    collectCoverageFrom: [\n        "**/*.{js,jsx,ts,tsx}",\n        "!**/*.d.ts",\n        "!**/node_modules/**",\n        "!<rootDir>/out/**",\n        "!<rootDir>/.next/**",\n        "!<rootDir>/*.config.js",\n        "!<rootDir>/coverage/**",\n    ],\n    moduleNameMapper: {\n        // Handle CSS imports (with CSS modules)\n        // https://jestjs.io/docs/webpack#mocking-css-modules\n        "^.+\\\\.module\\\\.(css|sass|scss)$": "identity-obj-proxy",\n\n        // Handle CSS imports (without CSS modules)\n        "^.+\\\\.(css|sass|scss)$": "<rootDir>/__mocks__/styleMock.js",\n\n        // Handle image imports\n        // https://jestjs.io/docs/webpack#handling-static-assets\n        "^.+\\\\.(png|jpg|jpeg|gif|webp|avif|ico|bmp|svg)$/i": `<rootDir>/__mocks__/fileMock.js`,\n\n        // Handle module aliases\n        "^@/components/(.*)$": "<rootDir>/components/$1",\n    },\n    // Add more setup options before each test is run\n    // setupFilesAfterEnv: [\'<rootDir>/jest.setup.js\'],\n    testPathIgnorePatterns: ["<rootDir>/node_modules/", "<rootDir>/.next/"],\n    testEnvironment: "jsdom",\n    transform: {\n        // Use babel-jest to transpile tests with the next/babel preset\n        // https://jestjs.io/docs/configuration#transform-objectstring-pathtotransformer--pathtotransformer-object\n        "^.+\\\\.(js|jsx|ts|tsx)$": ["babel-jest", { presets: ["next/babel"] }],\n    },\n    transformIgnorePatterns: [\n        "/node_modules/",\n        "^.+\\\\.module\\\\.(css|sass|scss)$",\n    ],\n};\n')),(0,s.kt)("p",null,"You can learn more about each configuration option in the ",(0,s.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/configuration"},"Jest docs"),"."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Handling stylesheets and image imports")),(0,s.kt)("p",null,"Stylesheets and images aren't used in the tests but importing them may cause errors, so they will need to be mocked. Create the mock files referenced in the configuration above - ",(0,s.kt)("inlineCode",{parentName:"p"},"fileMock.js")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"styleMock.js")," - inside a ",(0,s.kt)("inlineCode",{parentName:"p"},"__mocks__")," directory:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="__mocks__/fileMock.js"',filename:'"__mocks__/fileMock.js"'},'module.exports = {\n    src: "/img.jpg",\n    height: 24,\n    width: 24,\n    blurDataURL: "data:image/png;base64,imagedata",\n};\n')),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="__mocks__/styleMock.js"',filename:'"__mocks__/styleMock.js"'},"module.exports = {};\n")),(0,s.kt)("p",null,"For more information on handling static assets, please refer to the ",(0,s.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/webpack#handling-static-assets"},"Jest Docs"),"."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Optional: Extend Jest with custom matchers")),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"@testing-library/jest-dom")," includes a set of convenient ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/testing-library/jest-dom#custom-matchers"},"custom matchers")," such as ",(0,s.kt)("inlineCode",{parentName:"p"},".toBeInTheDocument()")," making it easier to write tests. You can import the custom matchers for every test by adding the following option to the Jest configuration file:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="jest.config.js"',filename:'"jest.config.js"'},'setupFilesAfterEnv: ["<rootDir>/jest.setup.js"];\n')),(0,s.kt)("p",null,"Then, inside ",(0,s.kt)("inlineCode",{parentName:"p"},"jest.setup.js"),", add the following import:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="jest.setup.js"',filename:'"jest.setup.js"'},'import "@testing-library/jest-dom";\n')),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("a",{parentName:"p",href:"https://github.com/testing-library/jest-dom/releases/tag/v6.0.0"},(0,s.kt)("inlineCode",{parentName:"a"},"extend-expect")," was removed in ",(0,s.kt)("inlineCode",{parentName:"a"},"v6.0")),", so if you are using ",(0,s.kt)("inlineCode",{parentName:"p"},"@testing-library/jest-dom")," before version 6, you will need to import ",(0,s.kt)("inlineCode",{parentName:"p"},"@testing-library/jest-dom/extend-expect")," instead.")),(0,s.kt)("p",null,"If you need to add more setup options before each test, it's common to add them to the ",(0,s.kt)("inlineCode",{parentName:"p"},"jest.setup.js")," file above."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Optional: Absolute Imports and Module Path Aliases")),(0,s.kt)("p",null,"If your project is using ",(0,s.kt)("a",{parentName:"p",href:"/docs/pages/building-your-application/configuring/absolute-imports-and-module-aliases"},"Module Path Aliases"),", you will need to configure Jest to resolve the imports by matching the paths option in the ",(0,s.kt)("inlineCode",{parentName:"p"},"jsconfig.json")," file with the ",(0,s.kt)("inlineCode",{parentName:"p"},"moduleNameMapper")," option in the ",(0,s.kt)("inlineCode",{parentName:"p"},"jest.config.js")," file. For example:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json",metastring:'filename="tsconfig.json or jsconfig.json"',filename:'"tsconfig.json',or:!0,'jsconfig.json"':!0},'{\n    "compilerOptions": {\n        "module": "esnext",\n        "moduleResolution": "node",\n        "baseUrl": "./",\n        "paths": {\n            "@/components/*": ["components/*"]\n        }\n    }\n}\n')),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="jest.config.js"',filename:'"jest.config.js"'},"moduleNameMapper: {\n  '^@/components/(.*)$': '<rootDir>/components/$1',\n}\n")),(0,s.kt)("h3",{id:"creating-your-tests"},"Creating your tests:"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Add a test script to package.json")),(0,s.kt)("p",null,"Add the Jest executable in watch mode to the ",(0,s.kt)("inlineCode",{parentName:"p"},"package.json")," scripts:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json",metastring:'filename="package.json"',filename:'"package.json"'},'{\n    "scripts": {\n        "dev": "next dev",\n        "build": "next build",\n        "start": "next start",\n        "test": "jest --watch"\n    }\n}\n')),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"jest --watch")," will re-run tests when a file is changed. For more Jest CLI options, please refer to the ",(0,s.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/cli#reference"},"Jest Docs"),"."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Create your first tests")),(0,s.kt)("p",null,"Your project is now ready to run tests. Follow Jest's convention by adding tests to the ",(0,s.kt)("inlineCode",{parentName:"p"},"__tests__")," folder in your project's root directory."),(0,s.kt)("p",null,"For example, we can add a test to check if the ",(0,s.kt)("inlineCode",{parentName:"p"},"<Home />")," component successfully renders a heading:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'filename="__tests__/index.test.js"',filename:'"__tests__/index.test.js"'},'import { render, screen } from "@testing-library/react";\nimport Home from "../pages/index";\nimport "@testing-library/jest-dom";\n\ndescribe("Home", () => {\n    it("renders a heading", () => {\n        render(<Home />);\n\n        const heading = screen.getByRole("heading", {\n            name: /welcome to next\\.js!/i,\n        });\n\n        expect(heading).toBeInTheDocument();\n    });\n});\n')),(0,s.kt)("p",null,"Optionally, add a ",(0,s.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/snapshot-testing"},"snapshot test")," to keep track of any unexpected changes to your ",(0,s.kt)("inlineCode",{parentName:"p"},"<Home />")," component:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'filename="__tests__/snapshot.js"',filename:'"__tests__/snapshot.js"'},'import { render } from "@testing-library/react";\nimport Home from "../pages/index";\n\nit("renders homepage unchanged", () => {\n    const { container } = render(<Home />);\n    expect(container).toMatchSnapshot();\n});\n')),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("strong",{parentName:"p"},"Good to know"),": Test files should not be included inside the Pages Router because any files inside the Pages Router are considered routes.")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Running your test suite")),(0,s.kt)("p",null,"Run ",(0,s.kt)("inlineCode",{parentName:"p"},"npm run test")," to run your test suite. After your tests pass or fail, you will notice a list of interactive Jest commands that will be helpful as you add more tests."),(0,s.kt)("p",null,"For further reading, you may find these resources helpful:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://jestjs.io/docs/getting-started"},"Jest Docs")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://testing-library.com/docs/react-testing-library/intro/"},"React Testing Library Docs")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://testing-playground.com/"},"Testing Playground")," - use good testing practices to match elements.")),(0,s.kt)("h2",{id:"community-packages-and-examples"},"Community Packages and Examples"),(0,s.kt)("p",null,"The Next.js community has created packages and articles you may find helpful:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/scottrippey/next-router-mock"},"next-router-mock")," for Storybook."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://glebbahmutov.com/blog/develop-preview-test/"},"Test Preview Vercel Deploys with Cypress")," by Gleb Bahmutov.")),(0,s.kt)("p",null,"For more information on what to read next, we recommend:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"- pages/basic-features/environment-variables#test-environment-variables\n")))}m.isMDXComponent=!0}}]);