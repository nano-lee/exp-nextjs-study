"use strict";(self.webpackChunktest=self.webpackChunktest||[]).push([[2904],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=l(n),m=r,h=u["".concat(p,".").concat(m)]||u[m]||d[m]||s;return n?a.createElement(h,o(o({ref:t},c),{},{components:n})):a.createElement(h,o({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=m;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[u]="string"==typeof e?e:r,o[1]=i;for(var l=2;l<s;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},703:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>f,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var a=n(7462),r=(n(7294),n(3905));const s={sidebar_position:10,title:"Route Handlers",description:"Create custom request handlers for a given route using the Web's Request and Response APIs.",related:{title:"API Reference",description:"Learn more about the route.js file.",links:["app/api-reference/file-conventions/route"]}},o=void 0,i={unversionedId:"app/building-your-application/routing/route-handlers",id:"app/building-your-application/routing/route-handlers",title:"Route Handlers",description:"Create custom request handlers for a given route using the Web's Request and Response APIs.",source:"@site/docs/02-app/01-building-your-application/01-routing/10-route-handlers.mdx",sourceDirName:"02-app/01-building-your-application/01-routing",slug:"/app/building-your-application/routing/route-handlers",permalink:"/docs/app/building-your-application/routing/route-handlers",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/02-app/01-building-your-application/01-routing/10-route-handlers.mdx",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10,title:"Route Handlers",description:"Create custom request handlers for a given route using the Web's Request and Response APIs.",related:{title:"API Reference",description:"Learn more about the route.js file.",links:["app/api-reference/file-conventions/route"]}},sidebar:"nextJsSidebar",previous:{title:"Intercepting Routes",permalink:"/docs/app/building-your-application/routing/intercepting-routes"},next:{title:"Middleware",permalink:"/docs/app/building-your-application/routing/middleware"}},p={},l=[{value:"Convention",id:"convention",level:2},{value:"Supported HTTP Methods",id:"supported-http-methods",level:3},{value:"Extended <code>NextRequest</code> and <code>NextResponse</code> APIs",id:"extended-nextrequest-and-nextresponse-apis",level:3},{value:"Behavior",id:"behavior",level:2},{value:"Caching",id:"caching",level:3},{value:"Opting out of caching",id:"opting-out-of-caching",level:3},{value:"Route Resolution",id:"route-resolution",level:3},{value:"Examples",id:"examples",level:2},{value:"Revalidating Cached Data",id:"revalidating-cached-data",level:3},{value:"Dynamic Functions",id:"dynamic-functions",level:3},{value:"Cookies",id:"cookies",level:4},{value:"Headers",id:"headers",level:4},{value:"Redirects",id:"redirects",level:3},{value:"Dynamic Route Segments",id:"dynamic-route-segments",level:3},{value:"URL Query Parameters",id:"url-query-parameters",level:3},{value:"Streaming",id:"streaming",level:3},{value:"Request Body",id:"request-body",level:3},{value:"Request Body FormData",id:"request-body-formdata",level:3},{value:"CORS",id:"cors",level:3},{value:"Edge and Node.js Runtimes",id:"edge-and-nodejs-runtimes",level:3},{value:"Non-UI Responses",id:"non-ui-responses",level:3},{value:"Segment Config Options",id:"segment-config-options",level:3}],c=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},u=c("Image"),d=c("Cross"),m=c("Check"),h={toc:l},g="wrapper";function f(e){let{components:t,...n}=e;return(0,r.kt)(g,(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Route Handlers allow you to create custom request handlers for a given route using the Web ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/docs/Web/API/Request"},"Request")," and ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/docs/Web/API/Response"},"Response")," APIs."),(0,r.kt)(u,{alt:"Route.js Special File",srcLight:"/docs/light/route-special-file.png",srcDark:"/docs/dark/route-special-file.png",width:"1600",height:"444",mdxType:"Image"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Good to know"),": Route Handlers are only available inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"app")," directory. They are the equivalent of ",(0,r.kt)("a",{parentName:"p",href:"/docs/pages/building-your-application/routing/api-routes"},"API Routes")," inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"pages")," directory meaning you ",(0,r.kt)("strong",{parentName:"p"},"do not")," need to use API Routes and Route Handlers together.")),(0,r.kt)("h2",{id:"convention"},"Convention"),(0,r.kt)("p",null,"Route Handlers are defined in a ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/file-conventions/route"},(0,r.kt)("inlineCode",{parentName:"a"},"route.js|ts")," file")," inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"app")," directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/api/route.ts" switcher',filename:'"app/api/route.ts"',switcher:!0},"export async function GET(request: Request) {}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/api/route.js" switcher',filename:'"app/api/route.js"',switcher:!0},"export async function GET(request) {}\n")),(0,r.kt)("p",null,"Route Handlers can be nested inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"app")," directory, similar to ",(0,r.kt)("inlineCode",{parentName:"p"},"page.js")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"layout.js"),". But there ",(0,r.kt)("strong",{parentName:"p"},"cannot")," be a ",(0,r.kt)("inlineCode",{parentName:"p"},"route.js")," file at the same route segment level as ",(0,r.kt)("inlineCode",{parentName:"p"},"page.js"),"."),(0,r.kt)("h3",{id:"supported-http-methods"},"Supported HTTP Methods"),(0,r.kt)("p",null,"The following ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/docs/Web/HTTP/Methods"},"HTTP methods")," are supported: ",(0,r.kt)("inlineCode",{parentName:"p"},"GET"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"POST"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"PUT"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"PATCH"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"DELETE"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"HEAD"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"OPTIONS"),". If an unsupported method is called, Next.js will return a ",(0,r.kt)("inlineCode",{parentName:"p"},"405 Method Not Allowed")," response."),(0,r.kt)("h3",{id:"extended-nextrequest-and-nextresponse-apis"},"Extended ",(0,r.kt)("inlineCode",{parentName:"h3"},"NextRequest")," and ",(0,r.kt)("inlineCode",{parentName:"h3"},"NextResponse")," APIs"),(0,r.kt)("p",null,"In addition to supporting native ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/docs/Web/API/Request"},"Request")," and ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/docs/Web/API/Response"},"Response"),". Next.js extends them with\n",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/functions/next-request"},(0,r.kt)("inlineCode",{parentName:"a"},"NextRequest"))," and ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/functions/next-response"},(0,r.kt)("inlineCode",{parentName:"a"},"NextResponse"))," to provide convenient helpers for advanced use cases."),(0,r.kt)("h2",{id:"behavior"},"Behavior"),(0,r.kt)("h3",{id:"caching"},"Caching"),(0,r.kt)("p",null,"Route Handlers are cached by default when using the ",(0,r.kt)("inlineCode",{parentName:"p"},"GET")," method with the ",(0,r.kt)("inlineCode",{parentName:"p"},"Response")," object."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/items/route.ts" switcher',filename:'"app/items/route.ts"',switcher:!0},'export async function GET() {\n    const res = await fetch("https://data.mongodb-api.com/...", {\n        headers: {\n            "Content-Type": "application/json",\n            "API-Key": process.env.DATA_API_KEY,\n        },\n    });\n    const data = await res.json();\n\n    return Response.json({ data });\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/items/route.js" switcher',filename:'"app/items/route.js"',switcher:!0},'export async function GET() {\n    const res = await fetch("https://data.mongodb-api.com/...", {\n        headers: {\n            "Content-Type": "application/json",\n            "API-Key": process.env.DATA_API_KEY,\n        },\n    });\n    const data = await res.json();\n\n    return Response.json({ data });\n}\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"TypeScript Warning:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"Response.json()")," is only valid from TypeScript 5.2. If you use a lower TypeScript version, you can use ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/functions/next-response#json"},(0,r.kt)("inlineCode",{parentName:"a"},"NextResponse.json()"))," for typed responses instead.")),(0,r.kt)("h3",{id:"opting-out-of-caching"},"Opting out of caching"),(0,r.kt)("p",null,"You can opt out of caching by:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Using the ",(0,r.kt)("inlineCode",{parentName:"li"},"Request")," object with the ",(0,r.kt)("inlineCode",{parentName:"li"},"GET")," method."),(0,r.kt)("li",{parentName:"ul"},"Using any of the other HTTP methods."),(0,r.kt)("li",{parentName:"ul"},"Using ",(0,r.kt)("a",{parentName:"li",href:"#dynamic-functions"},"Dynamic Functions")," like ",(0,r.kt)("inlineCode",{parentName:"li"},"cookies")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"headers"),"."),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("a",{parentName:"li",href:"#segment-config-options"},"Segment Config Options")," manually specifies dynamic mode.")),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/products/api/route.ts" switcher',filename:'"app/products/api/route.ts"',switcher:!0},'export async function GET(request: Request) {\n    const { searchParams } = new URL(request.url);\n    const id = searchParams.get("id");\n    const res = await fetch(`https://data.mongodb-api.com/product/${id}`, {\n        headers: {\n            "Content-Type": "application/json",\n            "API-Key": process.env.DATA_API_KEY,\n        },\n    });\n    const product = await res.json();\n\n    return Response.json({ product });\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/products/api/route.js" switcher',filename:'"app/products/api/route.js"',switcher:!0},'export async function GET(request) {\n    const { searchParams } = new URL(request.url);\n    const id = searchParams.get("id");\n    const res = await fetch(`https://data.mongodb-api.com/product/${id}`, {\n        headers: {\n            "Content-Type": "application/json",\n            "API-Key": process.env.DATA_API_KEY,\n        },\n    });\n    const product = await res.json();\n\n    return Response.json({ product });\n}\n')),(0,r.kt)("p",null,"Similarly, the ",(0,r.kt)("inlineCode",{parentName:"p"},"POST")," method will cause the Route Handler to be evaluated dynamically."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/items/route.ts" switcher',filename:'"app/items/route.ts"',switcher:!0},'export async function POST() {\n    const res = await fetch("https://data.mongodb-api.com/...", {\n        method: "POST",\n        headers: {\n            "Content-Type": "application/json",\n            "API-Key": process.env.DATA_API_KEY,\n        },\n        body: JSON.stringify({ time: new Date().toISOString() }),\n    });\n\n    const data = await res.json();\n\n    return Response.json(data);\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/items/route.js" switcher',filename:'"app/items/route.js"',switcher:!0},'export async function POST() {\n    const res = await fetch("https://data.mongodb-api.com/...", {\n        method: "POST",\n        headers: {\n            "Content-Type": "application/json",\n            "API-Key": process.env.DATA_API_KEY,\n        },\n        body: JSON.stringify({ time: new Date().toISOString() }),\n    });\n\n    const data = await res.json();\n\n    return Response.json(data);\n}\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Good to know"),": Like API Routes, Route Handlers can be used for cases like handling form submissions. A new abstraction for ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/building-your-application/data-fetching/forms-and-mutations"},"handling forms and mutations")," that integrates deeply with React is being worked on.")),(0,r.kt)("h3",{id:"route-resolution"},"Route Resolution"),(0,r.kt)("p",null,"You can consider a ",(0,r.kt)("inlineCode",{parentName:"p"},"route")," the lowest level routing primitive."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"They ",(0,r.kt)("strong",{parentName:"li"},"do not")," participate in layouts or client-side navigations like ",(0,r.kt)("inlineCode",{parentName:"li"},"page"),"."),(0,r.kt)("li",{parentName:"ul"},"There ",(0,r.kt)("strong",{parentName:"li"},"cannot")," be a ",(0,r.kt)("inlineCode",{parentName:"li"},"route.js")," file at the same route as ",(0,r.kt)("inlineCode",{parentName:"li"},"page.js"),".")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Page"),(0,r.kt)("th",{parentName:"tr",align:null},"Route"),(0,r.kt)("th",{parentName:"tr",align:null},"Result"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"app/page.js")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"app/route.js")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)(d,{size:18,mdxType:"Cross"})," Conflict")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"app/page.js")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"app/api/route.js")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)(m,{size:18,mdxType:"Check"})," Valid")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"app/[user]/page.js")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"app/api/route.js")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)(m,{size:18,mdxType:"Check"})," Valid")))),(0,r.kt)("p",null,"Each ",(0,r.kt)("inlineCode",{parentName:"p"},"route.js")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"page.js")," file takes over all HTTP verbs for that route."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'filename="app/page.js"',filename:'"app/page.js"'},"export default function Page() {\n    return <h1>Hello, Next.js!</h1>;\n}\n\n// \u274c Conflict\n// `app/route.js`\nexport async function POST(request) {}\n")),(0,r.kt)("h2",{id:"examples"},"Examples"),(0,r.kt)("p",null,"The following examples show how to combine Route Handlers with other Next.js APIs and features."),(0,r.kt)("h3",{id:"revalidating-cached-data"},"Revalidating Cached Data"),(0,r.kt)("p",null,"You can ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating#revalidating-data"},"revalidate cached data")," using the ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating#revalidating-data"},(0,r.kt)("inlineCode",{parentName:"a"},"next.revalidate"))," option:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/items/route.ts" switcher',filename:'"app/items/route.ts"',switcher:!0},'export async function GET() {\n    const res = await fetch("https://data.mongodb-api.com/...", {\n        next: { revalidate: 60 }, // Revalidate every 60 seconds\n    });\n    const data = await res.json();\n\n    return Response.json(data);\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/items/route.js" switcher',filename:'"app/items/route.js"',switcher:!0},'export async function GET() {\n    const res = await fetch("https://data.mongodb-api.com/...", {\n        next: { revalidate: 60 }, // Revalidate every 60 seconds\n    });\n    const data = await res.json();\n\n    return Response.json(data);\n}\n')),(0,r.kt)("p",null,"Alternatively, you can use the ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/file-conventions/route-segment-config#revalidate"},(0,r.kt)("inlineCode",{parentName:"a"},"revalidate")," segment config option"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"export const revalidate = 60;\n")),(0,r.kt)("h3",{id:"dynamic-functions"},"Dynamic Functions"),(0,r.kt)("p",null,"Route Handlers can be used with dynamic functions from Next.js, like ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/functions/cookies"},(0,r.kt)("inlineCode",{parentName:"a"},"cookies"))," and ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/functions/headers"},(0,r.kt)("inlineCode",{parentName:"a"},"headers")),"."),(0,r.kt)("h4",{id:"cookies"},"Cookies"),(0,r.kt)("p",null,"You can read cookies with ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/functions/cookies"},(0,r.kt)("inlineCode",{parentName:"a"},"cookies"))," from ",(0,r.kt)("inlineCode",{parentName:"p"},"next/headers"),". This server function can be called directly in a Route Handler, or nested inside of another function."),(0,r.kt)("p",null,"This ",(0,r.kt)("inlineCode",{parentName:"p"},"cookies")," instance is read-only. To set cookies, you need to return a new ",(0,r.kt)("inlineCode",{parentName:"p"},"Response")," using the ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/docs/Web/HTTP/Headers/Set-Cookie"},(0,r.kt)("inlineCode",{parentName:"a"},"Set-Cookie"))," header."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/api/route.ts" switcher',filename:'"app/api/route.ts"',switcher:!0},'import { cookies } from "next/headers";\n\nexport async function GET(request: Request) {\n    const cookieStore = cookies();\n    const token = cookieStore.get("token");\n\n    return new Response("Hello, Next.js!", {\n        status: 200,\n        headers: { "Set-Cookie": `token=${token.value}` },\n    });\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/api/route.js" switcher',filename:'"app/api/route.js"',switcher:!0},'import { cookies } from "next/headers";\n\nexport async function GET(request) {\n    const cookieStore = cookies();\n    const token = cookieStore.get("token");\n\n    return new Response("Hello, Next.js!", {\n        status: 200,\n        headers: { "Set-Cookie": `token=${token}` },\n    });\n}\n')),(0,r.kt)("p",null,"Alternatively, you can use abstractions on top of the underlying Web APIs to read cookies (",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/functions/next-request"},(0,r.kt)("inlineCode",{parentName:"a"},"NextRequest")),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/api/route.ts" switcher',filename:'"app/api/route.ts"',switcher:!0},'import { type NextRequest } from "next/server";\n\nexport async function GET(request: NextRequest) {\n    const token = request.cookies.get("token");\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/api/route.js" switcher',filename:'"app/api/route.js"',switcher:!0},'export async function GET(request) {\n    const token = request.cookies.get("token");\n}\n')),(0,r.kt)("h4",{id:"headers"},"Headers"),(0,r.kt)("p",null,"You can read headers with ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/functions/headers"},(0,r.kt)("inlineCode",{parentName:"a"},"headers"))," from ",(0,r.kt)("inlineCode",{parentName:"p"},"next/headers"),". This server function can be called directly in a Route Handler, or nested inside of another function."),(0,r.kt)("p",null,"This ",(0,r.kt)("inlineCode",{parentName:"p"},"headers")," instance is read-only. To set headers, you need to return a new ",(0,r.kt)("inlineCode",{parentName:"p"},"Response")," with new ",(0,r.kt)("inlineCode",{parentName:"p"},"headers"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/api/route.ts" switcher',filename:'"app/api/route.ts"',switcher:!0},'import { headers } from "next/headers";\n\nexport async function GET(request: Request) {\n    const headersList = headers();\n    const referer = headersList.get("referer");\n\n    return new Response("Hello, Next.js!", {\n        status: 200,\n        headers: { referer: referer },\n    });\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/api/route.js" switcher',filename:'"app/api/route.js"',switcher:!0},'import { headers } from "next/headers";\n\nexport async function GET(request) {\n    const headersList = headers();\n    const referer = headersList.get("referer");\n\n    return new Response("Hello, Next.js!", {\n        status: 200,\n        headers: { referer: referer },\n    });\n}\n')),(0,r.kt)("p",null,"Alternatively, you can use abstractions on top of the underlying Web APIs to read headers (",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/functions/next-request"},(0,r.kt)("inlineCode",{parentName:"a"},"NextRequest")),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/api/route.ts" switcher',filename:'"app/api/route.ts"',switcher:!0},'import { type NextRequest } from "next/server";\n\nexport async function GET(request: NextRequest) {\n    const requestHeaders = new Headers(request.headers);\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/api/route.js" switcher',filename:'"app/api/route.js"',switcher:!0},"export async function GET(request) {\n    const requestHeaders = new Headers(request.headers);\n}\n")),(0,r.kt)("h3",{id:"redirects"},"Redirects"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/api/route.ts" switcher',filename:'"app/api/route.ts"',switcher:!0},'import { redirect } from "next/navigation";\n\nexport async function GET(request: Request) {\n    redirect("https://nextjs.org/");\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/api/route.js" switcher',filename:'"app/api/route.js"',switcher:!0},'import { redirect } from "next/navigation";\n\nexport async function GET(request) {\n    redirect("https://nextjs.org/");\n}\n')),(0,r.kt)("h3",{id:"dynamic-route-segments"},"Dynamic Route Segments"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"We recommend reading the ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/building-your-application/routing/defining-routes"},"Defining Routes")," page before continuing.")),(0,r.kt)("p",null,"Route Handlers can use ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/building-your-application/routing/dynamic-routes"},"Dynamic Segments")," to create request handlers from dynamic data."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/items/[slug]/route.ts" switcher',filename:'"app/items/[slug]/route.ts"',switcher:!0},"export async function GET(\n    request: Request,\n    { params }: { params: { slug: string } },\n) {\n    const slug = params.slug; // 'a', 'b', or 'c'\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/items/[slug]/route.js" switcher',filename:'"app/items/[slug]/route.js"',switcher:!0},"export async function GET(request, { params }) {\n    const slug = params.slug; // 'a', 'b', or 'c'\n}\n")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Route"),(0,r.kt)("th",{parentName:"tr",align:null},"Example URL"),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"th"},"params")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"app/items/[slug]/route.js")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/items/a")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"{ slug: 'a' }"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"app/items/[slug]/route.js")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/items/b")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"{ slug: 'b' }"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"app/items/[slug]/route.js")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/items/c")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"{ slug: 'c' }"))))),(0,r.kt)("h3",{id:"url-query-parameters"},"URL Query Parameters"),(0,r.kt)("p",null,"The request object passed to the Route Handler is a ",(0,r.kt)("inlineCode",{parentName:"p"},"NextRequest")," instance, which has ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/functions/next-request#nexturl"},"some additional convenience methods"),", including for more easily handling query parameters."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/api/search/route.ts" switcher',filename:'"app/api/search/route.ts"',switcher:!0},'import { type NextRequest } from "next/server";\n\nexport function GET(request: NextRequest) {\n    const searchParams = request.nextUrl.searchParams;\n    const query = searchParams.get("query");\n    // query is "hello" for /api/search?query=hello\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/api/search/route.js" switcher',filename:'"app/api/search/route.js"',switcher:!0},'export function GET(request) {\n    const searchParams = request.nextUrl.searchParams;\n    const query = searchParams.get("query");\n    // query is "hello" for /api/search?query=hello\n}\n')),(0,r.kt)("h3",{id:"streaming"},"Streaming"),(0,r.kt)("p",null,"Streaming is commonly used in combination with Large Language Models (LLMs), such as OpenAI, for AI-generated content. Learn more about the ",(0,r.kt)("a",{parentName:"p",href:"https://sdk.vercel.ai/docs"},"AI SDK"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/api/chat/route.ts" switcher',filename:'"app/api/chat/route.ts"',switcher:!0},'import { Configuration, OpenAIApi } from "openai-edge";\nimport { OpenAIStream, StreamingTextResponse } from "ai";\n\nexport const runtime = "edge";\n\nconst apiConfig = new Configuration({\n    apiKey: process.env.OPENAI_API_KEY!,\n});\n\nconst openai = new OpenAIApi(apiConfig);\n\nexport async function POST(req: Request) {\n    // Extract the `messages` from the body of the request\n    const { messages } = await req.json();\n\n    // Request the OpenAI API for the response based on the prompt\n    const response = await openai.createChatCompletion({\n        model: "gpt-3.5-turbo",\n        stream: true,\n        messages: messages,\n        max_tokens: 500,\n        temperature: 0.7,\n        top_p: 1,\n        frequency_penalty: 1,\n        presence_penalty: 1,\n    });\n\n    // Convert the response into a friendly text-stream\n    const stream = OpenAIStream(response);\n\n    // Respond with the stream\n    return new StreamingTextResponse(stream);\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/api/chat/route.js" switcher',filename:'"app/api/chat/route.js"',switcher:!0},'import { Configuration, OpenAIApi } from "openai-edge";\nimport { OpenAIStream, StreamingTextResponse } from "ai";\n\nexport const runtime = "edge";\n\nconst apiConfig = new Configuration({\n    apiKey: process.env.OPENAI_API_KEY,\n});\n\nconst openai = new OpenAIApi(apiConfig);\n\nexport async function POST(req) {\n    // Extract the `messages` from the body of the request\n    const { messages } = await req.json();\n\n    // Request the OpenAI API for the response based on the prompt\n    const response = await openai.createChatCompletion({\n        model: "gpt-3.5-turbo",\n        stream: true,\n        messages: messages,\n        max_tokens: 500,\n        temperature: 0.7,\n        top_p: 1,\n        frequency_penalty: 1,\n        presence_penalty: 1,\n    });\n\n    // Convert the response into a friendly text-stream\n    const stream = OpenAIStream(response);\n\n    // Respond with the stream\n    return new StreamingTextResponse(stream);\n}\n')),(0,r.kt)("p",null,"These abstractions use the Web APIs to create a stream. You can also use the underlying Web APIs directly."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/api/route.ts" switcher',filename:'"app/api/route.ts"',switcher:!0},'// https://developer.mozilla.org/docs/Web/API/ReadableStream#convert_async_iterator_to_stream\nfunction iteratorToStream(iterator: any) {\n    return new ReadableStream({\n        async pull(controller) {\n            const { value, done } = await iterator.next();\n\n            if (done) {\n                controller.close();\n            } else {\n                controller.enqueue(value);\n            }\n        },\n    });\n}\n\nfunction sleep(time: number) {\n    return new Promise((resolve) => {\n        setTimeout(resolve, time);\n    });\n}\n\nconst encoder = new TextEncoder();\n\nasync function* makeIterator() {\n    yield encoder.encode("<p>One</p>");\n    await sleep(200);\n    yield encoder.encode("<p>Two</p>");\n    await sleep(200);\n    yield encoder.encode("<p>Three</p>");\n}\n\nexport async function GET() {\n    const iterator = makeIterator();\n    const stream = iteratorToStream(iterator);\n\n    return new Response(stream);\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/api/route.js" switcher',filename:'"app/api/route.js"',switcher:!0},'// https://developer.mozilla.org/docs/Web/API/ReadableStream#convert_async_iterator_to_stream\nfunction iteratorToStream(iterator) {\n    return new ReadableStream({\n        async pull(controller) {\n            const { value, done } = await iterator.next();\n\n            if (done) {\n                controller.close();\n            } else {\n                controller.enqueue(value);\n            }\n        },\n    });\n}\n\nfunction sleep(time) {\n    return new Promise((resolve) => {\n        setTimeout(resolve, time);\n    });\n}\n\nconst encoder = new TextEncoder();\n\nasync function* makeIterator() {\n    yield encoder.encode("<p>One</p>");\n    await sleep(200);\n    yield encoder.encode("<p>Two</p>");\n    await sleep(200);\n    yield encoder.encode("<p>Three</p>");\n}\n\nexport async function GET() {\n    const iterator = makeIterator();\n    const stream = iteratorToStream(iterator);\n\n    return new Response(stream);\n}\n')),(0,r.kt)("h3",{id:"request-body"},"Request Body"),(0,r.kt)("p",null,"You can read the ",(0,r.kt)("inlineCode",{parentName:"p"},"Request")," body using the standard Web API methods:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/items/route.ts" switcher',filename:'"app/items/route.ts"',switcher:!0},"export async function POST(request: Request) {\n    const res = await request.json();\n    return Response.json({ res });\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/items/route.js" switcher',filename:'"app/items/route.js"',switcher:!0},"export async function POST(request) {\n    const res = await request.json();\n    return Response.json({ res });\n}\n")),(0,r.kt)("h3",{id:"request-body-formdata"},"Request Body FormData"),(0,r.kt)("p",null,"You can read the ",(0,r.kt)("inlineCode",{parentName:"p"},"FormData")," using the ",(0,r.kt)("inlineCode",{parentName:"p"},"request.formData()")," function:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/items/route.ts" switcher',filename:'"app/items/route.ts"',switcher:!0},'export async function POST(request: Request) {\n    const formData = await request.formData();\n    const name = formData.get("name");\n    const email = formData.get("email");\n    return Response.json({ name, email });\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/items/route.js" switcher',filename:'"app/items/route.js"',switcher:!0},'export async function POST(request) {\n    const formData = await request.formData();\n    const name = formData.get("name");\n    const email = formData.get("email");\n    return Response.json({ name, email });\n}\n')),(0,r.kt)("p",null,"Since ",(0,r.kt)("inlineCode",{parentName:"p"},"formData")," data are all strings, you may want to use ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/zod-form-data"},(0,r.kt)("inlineCode",{parentName:"a"},"zod-form-data"))," to validate the request and retrieve data in the format you prefer (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"number"),")."),(0,r.kt)("h3",{id:"cors"},"CORS"),(0,r.kt)("p",null,"You can set CORS headers on a ",(0,r.kt)("inlineCode",{parentName:"p"},"Response")," using the standard Web API methods:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/api/route.ts" switcher',filename:'"app/api/route.ts"',switcher:!0},'export async function GET(request: Request) {\n    return new Response("Hello, Next.js!", {\n        status: 200,\n        headers: {\n            "Access-Control-Allow-Origin": "*",\n            "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS",\n            "Access-Control-Allow-Headers": "Content-Type, Authorization",\n        },\n    });\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/api/route.js" switcher',filename:'"app/api/route.js"',switcher:!0},'export async function GET(request) {\n    return new Response("Hello, Next.js!", {\n        status: 200,\n        headers: {\n            "Access-Control-Allow-Origin": "*",\n            "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS",\n            "Access-Control-Allow-Headers": "Content-Type, Authorization",\n        },\n    });\n}\n')),(0,r.kt)("h3",{id:"edge-and-nodejs-runtimes"},"Edge and Node.js Runtimes"),(0,r.kt)("p",null,"Route Handlers have an isomorphic Web API to support both Edge and Node.js runtimes seamlessly, including support for streaming. Since Route Handlers use the same ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/file-conventions/route-segment-config"},"route segment configuration")," as Pages and Layouts, they support long-awaited features like general-purpose ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating#revalidating-data"},"statically regenerated")," Route Handlers."),(0,r.kt)("p",null,"You can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"runtime")," segment config option to specify the runtime:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"export const runtime = \"edge\"; // 'nodejs' is the default\n")),(0,r.kt)("h3",{id:"non-ui-responses"},"Non-UI Responses"),(0,r.kt)("p",null,"You can use Route Handlers to return non-UI content. Note that ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/file-conventions/metadata/sitemap#generate-a-sitemap"},(0,r.kt)("inlineCode",{parentName:"a"},"sitemap.xml")),", ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/file-conventions/metadata/robots#generate-a-robots-file"},(0,r.kt)("inlineCode",{parentName:"a"},"robots.txt")),", ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/file-conventions/metadata/app-icons#generate-icons-using-code-js-ts-tsx"},(0,r.kt)("inlineCode",{parentName:"a"},"app icons")),", and ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/file-conventions/metadata/opengraph-image"},"open graph images")," all have built-in support."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/rss.xml/route.ts" switcher',filename:'"app/rss.xml/route.ts"',switcher:!0},'export async function GET() {\n    return new Response(`<?xml version="1.0" encoding="UTF-8" ?>\n<rss version="2.0">\n\n<channel>\n  <title>Next.js Documentation</title>\n  <link>https://nextjs.org/docs</link>\n  <description>The React Framework for the Web</description>\n</channel>\n\n</rss>`);\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/rss.xml/route.js" switcher',filename:'"app/rss.xml/route.js"',switcher:!0},'export async function GET() {\n    return new Response(`<?xml version="1.0" encoding="UTF-8" ?>\n<rss version="2.0">\n\n<channel>\n  <title>Next.js Documentation</title>\n  <link>https://nextjs.org/docs</link>\n  <description>The React Framework for the Web</description>\n</channel>\n\n</rss>`);\n}\n')),(0,r.kt)("h3",{id:"segment-config-options"},"Segment Config Options"),(0,r.kt)("p",null,"Route Handlers use the same ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/file-conventions/route-segment-config"},"route segment configuration")," as pages and layouts."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'filename="app/items/route.ts" switcher',filename:'"app/items/route.ts"',switcher:!0},'export const dynamic = "auto";\nexport const dynamicParams = true;\nexport const revalidate = false;\nexport const fetchCache = "auto";\nexport const runtime = "nodejs";\nexport const preferredRegion = "auto";\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'filename="app/items/route.js" switcher',filename:'"app/items/route.js"',switcher:!0},'export const dynamic = "auto";\nexport const dynamicParams = true;\nexport const revalidate = false;\nexport const fetchCache = "auto";\nexport const runtime = "nodejs";\nexport const preferredRegion = "auto";\n')),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/docs/app/api-reference/file-conventions/route-segment-config"},"API reference")," for more details."))}f.isMDXComponent=!0}}]);