"use strict";(self.webpackChunktest=self.webpackChunktest||[]).push([[6592],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>N});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=i.createContext({}),d=function(e){var t=i.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=d(e.components);return i.createElement(p.Provider,{value:t},e.children)},m="mdxType",k={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},u=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),m=d(n),u=a,N=m["".concat(p,".").concat(u)]||m[u]||k[u]||r;return n?i.createElement(N,l(l({ref:t},s),{},{components:n})):i.createElement(N,l({ref:t},s))}));function N(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,l=new Array(r);l[0]=u;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[m]="string"==typeof e?e:a,l[1]=o;for(var d=2;d<r;d++)l[d]=n[d];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}u.displayName="MDXCreateElement"},2200:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>k,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var i=n(7462),a=(n(7294),n(3905));const r={title:"NextRequest and NextResponse",description:"Learn about the server-only helpers for Middleware and Edge API Routes."},l=void 0,o={unversionedId:"pages/api-reference/functions/next-server",id:"pages/api-reference/functions/next-server",title:"NextRequest and NextResponse",description:"Learn about the server-only helpers for Middleware and Edge API Routes.",source:"@site/docs/03-pages/02-api-reference/02-functions/next-server.mdx",sourceDirName:"03-pages/02-api-reference/02-functions",slug:"/pages/api-reference/functions/next-server",permalink:"/docs/pages/api-reference/functions/next-server",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/03-pages/02-api-reference/02-functions/next-server.mdx",tags:[],version:"current",frontMatter:{title:"NextRequest and NextResponse",description:"Learn about the server-only helpers for Middleware and Edge API Routes."},sidebar:"tutorialSidebar",previous:{title:"getStaticProps",permalink:"/docs/pages/api-reference/functions/get-static-props"},next:{title:"useAmp",permalink:"/docs/pages/api-reference/functions/use-amp"}},p={},d=[{value:"NextRequest",id:"nextrequest",level:2},{value:"NextFetchEvent",id:"nextfetchevent",level:2},{value:"NextResponse",id:"nextresponse",level:2},{value:"Public Methods",id:"public-methods",level:3},{value:"Static Methods",id:"static-methods",level:3},{value:"userAgent",id:"useragent",level:2},{value:"FAQ",id:"faq",level:2},{value:"Why does <code>redirect</code> use 307 and 308?",id:"why-does-redirect-use-307-and-308",level:3},{value:"How do I access Environment Variables?",id:"how-do-i-access-environment-variables",level:3}],s={toc:d},m="wrapper";function k(e){let{components:t,...n}=e;return(0,a.kt)(m,(0,i.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"next/server")," provides server-only helpers for use in ",(0,a.kt)("a",{parentName:"p",href:"/docs/pages/building-your-application/routing/middleware"},"Middleware")," and ",(0,a.kt)("a",{parentName:"p",href:"/docs/pages/building-your-application/routing/api-routes"},"Edge API Routes"),"."),(0,a.kt)("h2",{id:"nextrequest"},"NextRequest"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"NextRequest")," object is an extension of the native ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/docs/Web/API/Request"},(0,a.kt)("inlineCode",{parentName:"a"},"Request"))," interface, with the following added methods and properties:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"cookies")," - A ",(0,a.kt)("a",{parentName:"p",href:"https://edge-runtime.vercel.app/packages/cookies#for-request"},"RequestCookies")," instance with cookies from the ",(0,a.kt)("inlineCode",{parentName:"p"},"Request"),". It reads/mutates the ",(0,a.kt)("inlineCode",{parentName:"p"},"Cookie")," header of the request. See also ",(0,a.kt)("a",{parentName:"p",href:"/docs/app/building-your-application/routing/middleware#using-cookies"},"Using cookies in Middleware"),"."),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"get")," - A method that takes a cookie ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," and returns an object with ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"value"),". If a cookie with ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," isn't found, it returns ",(0,a.kt)("inlineCode",{parentName:"li"},"undefined"),". If multiple cookies match, it will only return the first match."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"getAll")," - A method that is similar to ",(0,a.kt)("inlineCode",{parentName:"li"},"get"),", but returns a list of all the cookies with a matching ",(0,a.kt)("inlineCode",{parentName:"li"},"name"),". If ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," is unspecified, it returns all the available cookies."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"set")," - A method that takes an object with properties of ",(0,a.kt)("inlineCode",{parentName:"li"},"CookieListItem")," as defined in the ",(0,a.kt)("a",{parentName:"li",href:"https://wicg.github.io/cookie-store/#dictdef-cookielistitem"},"W3C CookieStore API")," spec."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"delete")," - A method that takes either a cookie ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," or a list of names. and removes the cookies matching the name(s). Returns ",(0,a.kt)("inlineCode",{parentName:"li"},"true")," for deleted and ",(0,a.kt)("inlineCode",{parentName:"li"},"false")," for undeleted cookies."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"has")," - A method that takes a cookie ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," and returns a ",(0,a.kt)("inlineCode",{parentName:"li"},"boolean")," based on if the cookie exists (",(0,a.kt)("inlineCode",{parentName:"li"},"true"),") or not (",(0,a.kt)("inlineCode",{parentName:"li"},"false"),")."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"clear")," - A method that takes no argument and will effectively remove the ",(0,a.kt)("inlineCode",{parentName:"li"},"Cookie")," header."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"nextUrl"),": Includes an extended, parsed, URL object that gives you access to Next.js specific properties such as ",(0,a.kt)("inlineCode",{parentName:"p"},"pathname"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"basePath"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"trailingSlash")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"i18n"),". Includes the following properties:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"basePath")," (",(0,a.kt)("inlineCode",{parentName:"li"},"string"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"buildId")," (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"defaultLocale")," (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"domainLocale"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"defaultLocale"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"string"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"domain"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"string"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"http"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"boolean || undefined"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"locales"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"string[] || undefined"),")"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"locale")," (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"url")," (",(0,a.kt)("inlineCode",{parentName:"li"},"URL"),")"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"ip"),": (",(0,a.kt)("inlineCode",{parentName:"p"},"string || undefined"),") - Has the IP address of the ",(0,a.kt)("inlineCode",{parentName:"p"},"Request"),". This information is provided by your hosting platform.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"geo")," - Has the geographic location from the ",(0,a.kt)("inlineCode",{parentName:"p"},"Request"),". This information is provided by your hosting platform. Includes the following properties:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"city")," (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"country")," (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"region")," (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"latitude")," (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"longitude")," (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),")")))),(0,a.kt)("p",null,"You can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"NextRequest")," object as a direct replacement for the native ",(0,a.kt)("inlineCode",{parentName:"p"},"Request")," interface, giving you more control over how you manipulate the request."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"NextRequest")," can be imported from ",(0,a.kt)("inlineCode",{parentName:"p"},"next/server"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import type { NextRequest } from 'next/server'\n")),(0,a.kt)("h2",{id:"nextfetchevent"},"NextFetchEvent"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"NextFetchEvent")," object extends the native ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/docs/Web/API/FetchEvent"},(0,a.kt)("inlineCode",{parentName:"a"},"FetchEvent"))," object, and includes the ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/docs/Web/API/ExtendableEvent/waitUntil"},(0,a.kt)("inlineCode",{parentName:"a"},"waitUntil()"))," method."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"waitUntil()")," method can be used to prolong the execution of the function if you have other background work to make."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { NextResponse } from 'next/server'\nimport type { NextFetchEvent, NextRequest } from 'next/server'\n\nexport function middleware(req: NextRequest, event: NextFetchEvent) {\n  event.waitUntil(\n    fetch('https://my-analytics-platform.com', {\n      method: 'POST',\n      body: JSON.stringify({ pathname: req.nextUrl.pathname }),\n    })\n  )\n\n  return NextResponse.next()\n}\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"NextFetchEvent")," object can be imported from ",(0,a.kt)("inlineCode",{parentName:"p"},"next/server"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import type { NextFetchEvent } from 'next/server'\n")),(0,a.kt)("h2",{id:"nextresponse"},"NextResponse"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"NextResponse")," class extends the native ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/docs/Web/API/Response"},(0,a.kt)("inlineCode",{parentName:"a"},"Response"))," interface, with the following:"),(0,a.kt)("h3",{id:"public-methods"},"Public Methods"),(0,a.kt)("p",null,"Public methods are available on an instance of the ",(0,a.kt)("inlineCode",{parentName:"p"},"NextResponse")," class. Depending on your use case, you can create an instance and assign to a variable, then access the following public methods:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cookies")," - A ",(0,a.kt)("a",{parentName:"li",href:"https://edge-runtime.vercel.app/packages/cookies#for-response"},"ResponseCookies")," instance with the cookies from the ",(0,a.kt)("inlineCode",{parentName:"li"},"Response"),". It reads/mutates the ",(0,a.kt)("inlineCode",{parentName:"li"},"Set-Cookie")," header of the response. See also ",(0,a.kt)("a",{parentName:"li",href:"/docs/app/building-your-application/routing/middleware#using-cookies"},"Using cookies in Middleware"),".",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"get")," - A method that takes a cookie ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," and returns an object with ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"value"),". If a cookie with ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," isn't found, it returns ",(0,a.kt)("inlineCode",{parentName:"li"},"undefined"),". If multiple cookies match, it will only return the first match."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"getAll")," - A method that is similar to ",(0,a.kt)("inlineCode",{parentName:"li"},"get"),", but returns a list of all the cookies with a matching ",(0,a.kt)("inlineCode",{parentName:"li"},"name"),". If ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," is unspecified, it returns all the available cookies."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"set")," - A method that takes an object with properties of ",(0,a.kt)("inlineCode",{parentName:"li"},"CookieListItem")," as defined in the ",(0,a.kt)("a",{parentName:"li",href:"https://wicg.github.io/cookie-store/#dictdef-cookielistitem"},"W3C CookieStore API")," spec."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"delete")," - A method that takes either a cookie ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," or a list of names. and removes the cookies matching the name(s). Returns ",(0,a.kt)("inlineCode",{parentName:"li"},"true")," for deleted and ",(0,a.kt)("inlineCode",{parentName:"li"},"false")," for undeleted cookies.")))),(0,a.kt)("h3",{id:"static-methods"},"Static Methods"),(0,a.kt)("p",null,"The following static methods are available on the ",(0,a.kt)("inlineCode",{parentName:"p"},"NextResponse")," class directly:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"redirect()")," - Returns a ",(0,a.kt)("inlineCode",{parentName:"li"},"NextResponse")," with a redirect set"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"rewrite()")," - Returns a ",(0,a.kt)("inlineCode",{parentName:"li"},"NextResponse")," with a rewrite set"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"next()")," - Returns a ",(0,a.kt)("inlineCode",{parentName:"li"},"NextResponse")," that will continue the middleware chain")),(0,a.kt)("p",null,"To use the methods above, ",(0,a.kt)("strong",{parentName:"p"},"you must return the ",(0,a.kt)("inlineCode",{parentName:"strong"},"NextResponse")," object")," returned. ",(0,a.kt)("inlineCode",{parentName:"p"},"NextResponse")," can be imported from ",(0,a.kt)("inlineCode",{parentName:"p"},"next/server"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { NextResponse } from 'next/server'\n")),(0,a.kt)("h2",{id:"useragent"},"userAgent"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"userAgent")," helper allows you to interact with the user agent object from the request. It is abstracted from the native ",(0,a.kt)("inlineCode",{parentName:"p"},"Request")," object, and is an opt in feature. It has the following properties:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"isBot"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"boolean"),") Whether the request comes from a known bot"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"browser"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"name"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),") The name of the browser"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"version"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),") The version of the browser, determined dynamically"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"device"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"model"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),") The model of the device, determined dynamically"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"type"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),") The type of the browser, can be one of the following values: ",(0,a.kt)("inlineCode",{parentName:"li"},"console"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"mobile"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"tablet"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"smarttv"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"wearable"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"embedded"),", or ",(0,a.kt)("inlineCode",{parentName:"li"},"undefined")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"vendor"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),") The vendor of the device, determined dynamically"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"engine"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"name"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),") The name of the browser engine, could be one of the following values: ",(0,a.kt)("inlineCode",{parentName:"li"},"Amaya"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"Blink"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"EdgeHTML"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"Flow"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"Gecko"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"Goanna"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"iCab"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"KHTML"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"Links"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"Lynx"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"NetFront"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"NetSurf"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"Presto"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"Tasman"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"Trident"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"w3m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"WebKit")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"undefined")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"version"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),") The version of the browser engine, determined dynamically, or ",(0,a.kt)("inlineCode",{parentName:"li"},"undefined")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"os"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"name"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),") The name of the OS, could be ",(0,a.kt)("inlineCode",{parentName:"li"},"undefined")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"version"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),") The version of the OS, determined dynamically, or ",(0,a.kt)("inlineCode",{parentName:"li"},"undefined")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cpu"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"architecture"),": (",(0,a.kt)("inlineCode",{parentName:"li"},"string || undefined"),") The architecture of the CPU, could be one of the following values: ",(0,a.kt)("inlineCode",{parentName:"li"},"68k"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"amd64"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"arm"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"arm64"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"armhf"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"avr"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"ia32"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"ia64"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"irix"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"irix64"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"mips"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"mips64"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"pa-risc"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"ppc"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"sparc"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"sparc64")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"undefined"))))),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"userAgent")," can be imported from ",(0,a.kt)("inlineCode",{parentName:"p"},"next/server"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { userAgent } from 'next/server'\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { NextRequest, NextResponse, userAgent } from 'next/server'\n\nexport function middleware(request: NextRequest) {\n  const url = request.nextUrl\n  const { device } = userAgent(request)\n  const viewport = device.type === 'mobile' ? 'mobile' : 'desktop'\n  url.searchParams.set('viewport', viewport)\n  return NextResponse.rewrite(url)\n}\n")),(0,a.kt)("h2",{id:"faq"},"FAQ"),(0,a.kt)("h3",{id:"why-does-redirect-use-307-and-308"},"Why does ",(0,a.kt)("inlineCode",{parentName:"h3"},"redirect")," use 307 and 308?"),(0,a.kt)("p",null,"When using ",(0,a.kt)("inlineCode",{parentName:"p"},"redirect()")," you may notice that the status codes used are ",(0,a.kt)("inlineCode",{parentName:"p"},"307")," for a temporary redirect, and ",(0,a.kt)("inlineCode",{parentName:"p"},"308")," for a permanent redirect. While traditionally a ",(0,a.kt)("inlineCode",{parentName:"p"},"302")," was used for a temporary redirect, and a ",(0,a.kt)("inlineCode",{parentName:"p"},"301")," for a permanent redirect, many browsers changed the request method of the redirect, from a ",(0,a.kt)("inlineCode",{parentName:"p"},"POST")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"GET")," request when using a ",(0,a.kt)("inlineCode",{parentName:"p"},"302"),", regardless of the origins request method."),(0,a.kt)("p",null,"Taking the following example of a redirect from ",(0,a.kt)("inlineCode",{parentName:"p"},"/users")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"/people"),", if you make a ",(0,a.kt)("inlineCode",{parentName:"p"},"POST")," request to ",(0,a.kt)("inlineCode",{parentName:"p"},"/users")," to create a new user, and are conforming to a ",(0,a.kt)("inlineCode",{parentName:"p"},"302")," temporary redirect, the request method will be changed from a ",(0,a.kt)("inlineCode",{parentName:"p"},"POST")," to a ",(0,a.kt)("inlineCode",{parentName:"p"},"GET")," request. This doesn't make sense, as to create a new user, you should be making a ",(0,a.kt)("inlineCode",{parentName:"p"},"POST")," request to ",(0,a.kt)("inlineCode",{parentName:"p"},"/people"),", and not a ",(0,a.kt)("inlineCode",{parentName:"p"},"GET")," request."),(0,a.kt)("p",null,"The introduction of the ",(0,a.kt)("inlineCode",{parentName:"p"},"307")," status code means that the request method is preserved as ",(0,a.kt)("inlineCode",{parentName:"p"},"POST"),"."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"302")," - Temporary redirect, will change the request method from ",(0,a.kt)("inlineCode",{parentName:"li"},"POST")," to ",(0,a.kt)("inlineCode",{parentName:"li"},"GET")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"307")," - Temporary redirect, will preserve the request method as ",(0,a.kt)("inlineCode",{parentName:"li"},"POST"))),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"redirect()")," method uses a ",(0,a.kt)("inlineCode",{parentName:"p"},"307")," by default, instead of a ",(0,a.kt)("inlineCode",{parentName:"p"},"302")," temporary redirect, meaning your requests will ",(0,a.kt)("em",{parentName:"p"},"always")," be preserved as ",(0,a.kt)("inlineCode",{parentName:"p"},"POST")," requests."),(0,a.kt)("p",null,"If you want to cause a ",(0,a.kt)("inlineCode",{parentName:"p"},"GET")," response to a ",(0,a.kt)("inlineCode",{parentName:"p"},"POST")," request, use ",(0,a.kt)("inlineCode",{parentName:"p"},"303"),"."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/docs/Web/HTTP/Redirections"},"Learn more")," about HTTP Redirects."),(0,a.kt)("h3",{id:"how-do-i-access-environment-variables"},"How do I access Environment Variables?"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"process.env")," can be used to access ",(0,a.kt)("a",{parentName:"p",href:"/docs/pages/building-your-application/configuring/environment-variables"},"Environment Variables")," from Edge Middleware. They are evaluated during ",(0,a.kt)("inlineCode",{parentName:"p"},"next build"),":"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Works"),(0,a.kt)("th",{parentName:"tr",align:null},"Does ",(0,a.kt)("strong",{parentName:"th"},"not")," work"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"console.log(process.env.MY_ENV_VARIABLE)")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"const getEnv = name => process.env[name]"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"const { MY_ENV_VARIABLE } = process.env")),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},'const { "MY-ENV-VARIABLE": MY_ENV_VARIABLE } = process.env')),(0,a.kt)("td",{parentName:"tr",align:null})))))}k.isMDXComponent=!0}}]);